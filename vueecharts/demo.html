<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.staticfile.org/echarts/5.4.1/echarts.min.js"></script>

</head>
<body>

<div id="app">
    <template>
<!--        <div>-->
<!--            <ul>-->
<!--                <li v-for="item in items">-->
<!--                    {{ item.name }}-->
<!--                </li>-->
<!--            </ul>-->
<!--        </div>-->
        <div class="chart-box">
            <div id="dynamic_data" style="width:1400px;height:500px;"></div>

        </div>
    </template>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>


<script>
    new Vue({
        el: '#app',
        data() {
            return {
                // categories:[],
                categories2:[],
                dynamic_data1:[],
                dynamic_data2:[],
                message: '',
            };
        },
        mounted() {

            // this.initdate()
            // 每2秒钟调用一次updateMessage方法
            this.dynamic_data_get()
            // this.intervalId = setInterval(this.dynamic_data_get,1000);
        },
        created() {
            // this.dynamic_data_get();
        },
        beforeDestroy() {
            // 清理定时器
            clearInterval(this.intervalId);
        },
        methods: {

            // initdate () {
            //     axios.get('http://127.0.0.1:9001/data').then(response => {
            //         console.log(response.data)
            //         this.categories = response.data
            //     })
            // },
            init() {
                // 执行初始化方法
                this.message = 'Hello, World!';
            },
            dynamic_data_get () {
                var app = {};


                var dynamic_data=echarts.init(document.getElementById('dynamic_data'));
                window.addEventListener('resize', function () {
                    dynamic_data.resize();
                });
                let categories = []
                let categories2 =[];
                axios.get('http://127.0.0.1:9001/data').then(response => {
                        console.log(response.data.date)
                        categories= response.data.date;
                    categories2=response.data.num;
                    })

                    // console.log(categories)




                // const categories2 = (function () {
                //     let res = [];
                //     let len = 10;
                //     while (len--) {
                //         res.push(10 - len - 1);
                //     }
                //     // console.log(res)
                //     return res;
                // })();
                const dynamicdata = (function () {
                    let res = [];
                    let len = 10;
                    while (len--) {
                        res.push(Math.round(Math.random() * 1000));
                    }
                    console.log(res)
                    return res;
                })();
                const data2 = (function () {
                    let res = [];
                    let len = 0;
                    while (len < 10) {
                        res.push(+(Math.random() * 10 + 5).toFixed(1));
                        len++;
                    }
                    console.log(res)
                    return res;
                })();
                option = {
                    grid:{
                        top: '20%',
                        bottom: '20%',
                    },
                    // title: {
                    //     text: 'Dynamic Data'
                    // },
                    tooltip: {

                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#283b56'
                            }
                        }
                    },
                    legend: {},
                    dataZoom: {
                        show: false,
                        start: 0,
                        end: 100
                    },
                    xAxis: [
                        {
                            type: 'category',
                            boundaryGap: true,
                            data: categories
                        },
                        {
                            type: 'category',
                            boundaryGap: true,
                            data: categories2
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            scale: true,
                            name: 'Price',
                            max: 30,
                            min: 0,
                            // boundaryGap: '50%',
                        },
                        {
                            type: 'value',
                            scale: true,
                            name: 'Order',
                            max: 1200,
                            min: 0,
                            // boundaryGap: '50%'
                        }
                    ],
                    series: [
                        {
                            // name: 'Dynamic Bar',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            data: dynamicdata
                        },
                        {
                            // name: 'Dynamic Line',
                            type: 'line',
                            data: data2
                        }
                    ]
                };
                app.count = 11;
                setInterval(function () {
                    let axisData = new Date().toLocaleTimeString().replace(/^\D*/, '');
                    dynamicdata.shift();
                    dynamicdata.push(Math.round(Math.random() * 1000));
                    data2.shift();
                    data2.push(+(Math.random() * 10 + 5).toFixed(1));
                    categories.shift();
                    categories.push(axisData);
                    categories2.shift();
                    categories2.push(app.count++);
                    dynamic_data.setOption({
                        xAxis: [
                            {
                                data: categories
                            },
                            {
                                data: categories2
                            }
                        ],
                        series: [
                            {
                                data: dynamicdata
                            },
                            {
                                data: data2
                            }
                        ]
                    });
                }, 2100);

                dynamic_data.setOption(option)
            },
        },
    });
</script>

<script>


</script>


<!--<script type="text/javascript">-->
<!--    // 基于准备好的dom，初始化echarts实例-->
<!--    var liuliangtu = echarts.init(document.getElementById('liuliangtu'));-->
<!--    window.addEventListener('resize', function () {-->
<!--        liuliangtu.resize();-->
<!--// myCharts.resize();-->
<!--    });-->
<!--    let base = +new Date(1968, 9, 3);-->
<!--    let oneDay = 24 * 3600 * 1000;-->
<!--    let date = [];-->
<!--    let data = [Math.random() * 300];-->
<!--    for (let i = 1; i < 2000; i++) {-->
<!--        var now = new Date((base += oneDay));-->
<!--        date.push([now.getFullYear(), now.getMonth() + 1, now.getDate()].join('/'));-->
<!--        data.push(Math.round((Math.random() - 0.5) * 20 + data[i - 1]));-->
<!--    }-->
<!--    console.log(date)-->
<!--    console.log(data)-->
<!--    var option = {-->
<!--        grid: {-->
<!--            top: '10%',-->
<!--// bottom: '20%' // 距离底部的距离为容器高度的 20%-->
<!--        },-->
<!--        tooltip: {-->
<!--            trigger: 'axis',-->
<!--            position: function (pt) {-->
<!--                return [pt[0], '0%'];-->
<!--            }-->
<!--        },-->
<!--// title: {-->
<!--//     left: 'center',-->
<!--//     text: 'Large Area Chart'-->
<!--// },-->
<!--        xAxis: {-->
<!--            type: 'category',-->
<!--            boundaryGap: false,-->
<!--            data: date-->
<!--        },-->
<!--        yAxis: {-->
<!--            type: 'value',-->
<!--            boundaryGap: [0, '20%']-->
<!--        },-->
<!--        dataZoom: [-->
<!--            {-->
<!--                type: 'slider',-->
<!--                start: 0,-->
<!--                end: 10-->
<!--            },-->

<!--        ],-->
<!--        series: [-->
<!--            {-->
<!--                name: 'Fake Data',-->
<!--                type: 'line',-->
<!--                symbol: 'none',-->
<!--                sampling: 'lttb',-->
<!--                itemStyle: {-->
<!--                    color: 'rgb(255, 70, 131)'-->
<!--                },-->
<!--                areaStyle: {-->
<!--                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [-->
<!--                        {-->
<!--                            offset: 0,-->
<!--                            color: 'rgb(255, 158, 68)'-->
<!--                        },-->
<!--                        {-->
<!--                            offset: 1,-->
<!--                            color: 'rgb(255, 70, 131)'-->
<!--                        }-->
<!--                    ])-->
<!--                },-->
<!--                data: data-->
<!--            }-->
<!--        ]-->
<!--    };-->

<!--    // 使用刚指定的配置项和数据显示图表。-->
<!--    liuliangtu.setOption(option);-->

<!--</script>-->


</body>
</html>
